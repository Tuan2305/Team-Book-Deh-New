{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block content %}

<!-- SECTION 1: MAIN CAROUSEL (LEFT) & SIDE BANNERS (RIGHT) - Theo layout Fahasa -->
<section class="section-main-banner-fahasa py-3">
    <div class="container">
        <div class="row pl-10 pr-10">
            <!-- Main Carousel (Left - 2/3 width) -->
            <div class="w-100 mb-3 mb-lg-0 ">
                {# Sử dụng carousel từ code cũ của bạn #}
                <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                    </ol>
                    <div class="carousel-inner rounded-lg"> {# Thêm class rounded-lg cho bo góc #}
                        <div class="carousel-item active">
                            {# Giữ nguyên link ảnh của bạn #}
                            <img src="/media/photos/testtt.jpg" class="d-block w-100" alt="First slide">
                        </div>
                        <div class="carousel-item">
                            <img src="/media/photos/test2.jpg" class="d-block w-100" alt="Second slide">
                        </div>
                        <div class="carousel-item">
                            <img src="/media/photos/test3.jpg" class="d-block w-100" alt="Third slide">
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>

            <!-- Side Banners (Right - 1/3 width) -->
            {% comment %} <div class="col-lg-4">
                <div class="mb-3">
                    {# Lấy một trong các ảnh banner từ code cũ của bạn cho vị trí này #}
                    {# Ví dụ: Banner "Quà Tặng Đặc Biệt" #}
                    <a href="#"><img src="/media/photos/test4.jpg" class="img-fluid rounded-lg" alt="Side Banner Top"></a>
                </div>
                <div>
                 <a href="#"><img src="/media/photos/test5.jpg" class="img-fluid rounded-lg" alt="Side Banner Bottom"></a> 
                </div>
            </div> {% endcomment %}
        </div>
    </div>
</section>

<section class="section-promotion-blocks-fahasa py-3">
    <div class="container">
    <div class="row">
        <div class="col-6 col-md-3 mb-3" style="padding-left: 0px; padding-right: 10px;">
            <div class="card promo-card-fahasa text-center h-100"> 
                <a href="#" class="promo-card-custom"> 
                    <div class="promo-card-image-wrapper"> 
                        <img src="/media/photos/test7.jpg" class="card-img-top" alt="05.05 Đón Hè Rực Rỡ"> 
                    </div>
                    <div class="card-body promo-card-fahasa-footer" style="background-color: #ED5156;">
                        <h6 class="card-title small text-white mb-0">MUA NGAY</h6>
                    </div>
                </a>
            </div>
        </div>

        <div class="col-6 col-md-3 mb-3">
            <div class="card promo-card-fahasa text-center h-100"> 
                <a href="#" class="promo-card-custom"> 
                    <div class="promo-card-image-wrapper"> 
                        <img src="/media/photos/test8.jpg" class="card-img-top" alt="26.05 Xả Kho"> 
                    </div>
                    <div class="card-body promo-card-fahasa-footer" style="background-color: #ED5156;">
                        <h6 class="card-title small text-white mb-0">MUA NGAY</h6>
                    </div>
                </a>
            </div>
        </div>

        <div class="col-6 col-md-3 mb-3">
            <div class="card promo-card-fahasa text-center h-100"> 
                <a href="#" class="promo-card-custom"> 
                    <div class="promo-card-image-wrapper"> 
                        <img src="/media/photos/salegiuathang.jpg" class="card-img-top" alt="15.05 Sale Giữa Tháng"> 
                    </div>
                    <div class="card-body promo-card-fahasa-footer" style="background-color: #ED5156;">
                        <h6 class="card-title small text-white mb-0">MUA NGAY</h6>
                    </div>
                </a>
            </div>
        </div>

        <div class="col-6 col-md-3 mb-3" style="padding-left: 10px; padding-right: 0px;>
            <div class="card promo-card-fahasa text-center h-100 last-promo-item" > 
                <a href="#" class="promo-card-custom"> 
                    <div class="promo-card-image-wrapper"> 
                        <img src="/media/photos/test9.jpg" class="" alt="Thứ 4 Ngày Vàng"> 
                    </div>
                    <div class="card-body promo-card-fahasa-footer" style="background-color: #ED5156;">
                        <h6 class="card-title small text-white mb-0">MUA NGAY</h6>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>
</section>




{# SECTION 4: PRODUCTS LISTING #}
{# Giữ lại section hiển thị sản phẩm "Bộ Sưu Tập Mới Nhất" hoặc "Popular products" #}
<section class="section-products-listing py-3">
    <div class="container" style="padding-left: 0px; padding-right: 0px;">

          <div class="bg-white p-3 rounded-lg shadow-sm">
            <h5 class="mb-3">Săn Deal Sách Đỉnh <a href="{% url 'store' %}" class="btn btn-sm btn-outline-primary float-right">Xem tất cả</a></h5>
            <div id="bookDealsCarousel" class="carousel slide" data-ride="carousel" data-interval="false">
                <div class="carousel-inner">
                    {% for product_chunk in products|slice:":12"|divisibleby:4 %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        <div class="row">
                            {% for product in product_chunk %}
                            <div class="col-md-3 col-6">
                                <div class="card card-product-grid-fahasa mb-3 h-100">
                                    <a href="{{ product.get_url }}" class="img-wrap">
                                        <img src="{{ product.images.url }}" class="product-image">
                                    </a>
                                    <figcaption class="info-wrap text-center">
                                        <a href="{{ product.get_url }}" class="title text-truncate mb-1">{{ product.product_name }}</a>
                                        {% if product.old_price %}
                                        <del class="price-old d-block">{{ product.old_price }}đ</del>
                                        {% endif %}
                                        <span class="price-new-bold d-block">{{ product.price }}đ</span>
                                    </figcaption>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <a class="carousel-control-prev" href="#bookDealsCarousel" role="button" data-slide="prev" style="width: 5%; background: rgba(162, 148, 148, 0.1);">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                </a>
                <a class="carousel-control-next" href="#bookDealsCarousel" role="button" data-slide="next" style="width: 5%; background: rgba(138, 133, 133, 0.1);">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                </a>
            </div>
        </div>


    <!-- Section Danh mục sản phẩm -->
<section class="section-categories py-4">
    <div class="container">
        <div class="bg-white p-3 rounded-lg shadow-sm mb-4">
            <h5 class="mb-3">Danh mục sản phẩm</h5>
            <div class="categories-carousel-container position-relative">
                <div class="categories-carousel d-flex overflow-auto pb-2">
                    {% for category in links %}
                    <div class="category-item-wrapper px-2" style="min-width: 140px;">
                        <a href="{{ category.get_url }}" class="category-item d-block text-center">
                            {% if category.cat_image %}
                                <img src="{{ category.cat_image.url }}" alt="{{ category.category_name }}" class="img-fluid rounded-circle mb-2" style="width: 80px; height: 80px; object-fit: cover;">
                            {% else %}
                                <div class="category-icon rounded-circle mx-auto mb-2 d-flex align-items-center justify-content-center" style="width: 80px; height: 80px; background-color: #f8f9fa;">
                                    <i class="fas fa-book fa-2x text-primary"></i>
                                </div>
                            {% endif %}
                            <h6 class="category-name small">{{ category.category_name }}</h6>
                        </a>
                    </div>
                    {% empty %}
                    <div class="w-100 text-center py-3">
                        <p class="text-muted">Chưa có danh mục sản phẩm nào.</p>
                    </div>
                    {% endfor %}
                </div>
               
            </div>
        </div>
    </div>
</section>
    

        <div class="bg-white p-3 rounded-lg shadow-sm mb-4">
            <h5 class="mb-3">
                {% if products %}Bộ Sưu Tập Mới Nhất{% else %}Sản Phẩm Nổi Bật{% endif %}
                <a href="{% url 'store' %}" class="btn btn-sm btn-outline-primary float-right">Xem tất cả</a>
            </h5>
            <div class="row">
                {% for product in products|slice:":8" %}
                <div class="col-6 col-md-4 col-lg-3">
                    <div class="card card-product-grid-fahasa mb-3 h-100">
                        <a href="{{ product.get_url }}" class="img-wrap">
                            <img src="{{ product.images.url }}" class="product-image">
                        </a>
                        <figcaption class="info-wrap text-center">
                            <a href="{{ product.get_url }}" class="title text-truncate mb-1">{{ product.product_name }}</a>
                            <div class="price-wrap mt-1">
                                {% if product.old_price %}
                                <del class="price-old d-block">{{ product.old_price }}đ</del>
                                {% endif %}
                                <span class="price-new-bold d-block">{{ product.price }}đ</span>
                            </div>
                        </figcaption>
                    </div>
                </div>
                {% empty %}
                <div class="col-12">
                    <p class="text-center">Chưa có sản phẩm nào để hiển thị.</p>
                </div>
                {% endfor %}
            </div>
        </div>

    

    </div>
</section>


{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.touchswipe/1.6.19/jquery.touchSwipe.min.js"></script>
<script src="{% static 'js/touch-carousel.js' %}"></script>
<script src="{% static 'js/categories-carousel.js' %}"></script>
{% endblock %}
{# Xóa các section không cần thiết từ code cũ #}
{# Ví dụ: section-name padding-y-sm (Popular products cuối cùng) có thể đã được tích hợp #}

{% endblock %}